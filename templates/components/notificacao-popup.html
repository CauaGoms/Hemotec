<!-- Popup de Notificações Não Lidas -->
<div id="notificacao-popup" class="notificacao-popup" style="display: none;">
    <div class="notificacao-popup-header">
        <h6 class="mb-0">
            <i class="fas fa-bell me-2"></i>Notificações
        </h6>
        <button class="btn-close-popup" onclick="fecharPopupNotificacoes()">
            <i class="fas fa-times"></i>
        </button>
    </div>
    <div class="notificacao-popup-body" id="notificacoes-lista">
        <!-- Notificações serão inseridas aqui via JavaScript --></div>
    <div class="notificacao-popup-footer">
        <a href="/doador/notificacao" class="btn-ver-todas">Ver todas as notificações</a>
    </div>
</div>
<style>
.notificacao-popup {
    position: fixed;
    top: 80px;
    right: 20px;
    width: 380px;
    max-width: 90vw;
    background: white;
    border-radius: 12px;
    box-shadow: 0 8px 32px rgba(0, 0, 0, 0.15);
    z-index: 9999;
    animation: slideInRight 0.3s ease-out;
    overflow: hidden;
}

@keyframes slideInRight {
    from {
        transform: translateX(100%);
        opacity: 0;
    }
    to {
        transform: translateX(0);
        opacity: 1;
    }
}

.notificacao-popup-header {
    background: linear-gradient(135deg, #dc3545 0%, #c82333 100%);
    color: white;
    padding: 15px 20px;
    display: flex;
    justify-content: space-between;
    align-items: center;
}

.notificacao-popup-header h6 {
    font-weight: 600;
    font-size: 16px;
}

.btn-close-popup {
    background: none;
    border: none;
    color: white;
    font-size: 18px;
    cursor: pointer;
    padding: 5px;
    line-height: 1;
    transition: transform 0.2s;
}

.btn-close-popup:hover {
    transform: scale(1.1);
}

.notificacao-popup-body {
    max-height: 300px;
    overflow-y: auto;
    padding: 10px;
}

.notificacao-item {
    background: #f8f9fa;
    border-left: 4px solid #dc3545;
    padding: 12px 15px;
    margin-bottom: 10px;
    border-radius: 8px;
    cursor: pointer;
    transition: all 0.3s;
}

.notificacao-item:hover {
    background: #e9ecef;
    transform: translateX(-3px);
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.1);
}

.notificacao-item-header {
    display: flex;
    justify-content: space-between;
    align-items: flex-start;
    margin-bottom: 5px;
}

.notificacao-item-titulo {
    font-weight: 600;
    font-size: 14px;
    color: #333;
    margin: 0;
}

.notificacao-item-data {
    font-size: 11px;
    color: #6c757d;
}

.notificacao-item-mensagem {
    font-size: 13px;
    color: #495057;
    margin: 5px 0 0 0;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
}

.notificacao-item-tipo {
    display: inline-block;
    padding: 2px 8px;
    border-radius: 4px;
    font-size: 10px;
    font-weight: 600;
    text-transform: uppercase;
    margin-top: 5px;
}

.tipo-urgente {
    background: #dc3545;
    color: white;
}

.tipo-informacao {
    background: #17a2b8;
    color: white;
}

.tipo-alerta {
    background: #ffc107;
    color: #212529;
}

.tipo-sucesso {
    background: #28a745;
    color: white;
}

.notificacao-popup-footer {
    background: #f8f9fa;
    padding: 12px 20px;
    text-align: center;
    border-top: 1px solid #dee2e6;
}

.btn-ver-todas {
    color: #dc3545;
    text-decoration: none;
    font-weight: 600;
    font-size: 14px;
    transition: color 0.3s;
}

.btn-ver-todas:hover {
    color: #c82333;
}

.notificacao-popup-body::-webkit-scrollbar {
    width: 6px;
}

.notificacao-popup-body::-webkit-scrollbar-track {
    background: #f1f1f1;
    border-radius: 10px;
}

.notificacao-popup-body::-webkit-scrollbar-thumb {
    background: #dc3545;
    border-radius: 10px;
}

.notificacao-popup-body::-webkit-scrollbar-thumb:hover {
    background: #c82333;
}

.notificacoes-vazia {
    text-align: center;
    padding: 30px 20px;
    color: #6c757d;
}

.notificacoes-vazia i {
    font-size: 48px;
    color: #dee2e6;
    margin-bottom: 10px;
}

.notificacoes-vazia p {
    margin: 0;
    font-size: 14px;
}

@media (max-width: 768px) {
    .notificacao-popup {
        width: calc(100vw - 40px);
        right: 20px;
        left: 20px;
        margin: 0 auto;
    }
}
</style>
<script>
function fecharPopupNotificacoes() {
    const popup = document.getElementById('notificacao-popup');
    popup.style.display = 'none';
}

function formatarDataNotificacao(dataStr) {
    const data = new Date(dataStr);
    const agora = new Date();
    const diff = Math.floor((agora - data) / 1000); // diferença em segundos

    if (diff < 60) return 'Agora';
    if (diff < 3600) return `Há ${Math.floor(diff / 60)} min`;
    if (diff < 86400) return `Há ${Math.floor(diff / 3600)} horas`;
    if (diff < 604800) return `Há ${Math.floor(diff / 86400)} dias`;
    
    return data.toLocaleDateString('pt-BR', { day: '2-digit', month: '2-digit' });
}

function getTipoClass(tipo) {
    const tipoLower = tipo.toLowerCase();
    if (tipoLower.includes('urgente') || tipoLower.includes('crítico')) return 'tipo-urgente';
    if (tipoLower.includes('alerta') || tipoLower.includes('aviso')) return 'tipo-alerta';
    if (tipoLower.includes('sucesso')) return 'tipo-sucesso';
    return 'tipo-informacao';
}

function exibirPopupNotificacoes(notificacoes) {
    const popup = document.getElementById('notificacao-popup');
    const lista = document.getElementById('notificacoes-lista');
    
    if (!notificacoes || notificacoes.length === 0) {
        lista.innerHTML = `
            <div class="notificacoes-vazia">
                <i class="fas fa-bell-slash"></i>
                <p>Nenhuma notificação não lida</p>
            </div>
        `;
    } else {
        lista.innerHTML = notificacoes.map(n => `
            <div class="notificacao-item" onclick="window.location.href='/doador/notificacao'">
                <div class="notificacao-item-header">
                    <h6 class="notificacao-item-titulo">${n.titulo}</h6>
                    <span class="notificacao-item-data">${formatarDataNotificacao(n.data_envio)}</span>
                </div>
                <p class="notificacao-item-mensagem">${n.mensagem}</p>
                <span class="notificacao-item-tipo ${getTipoClass(n.tipo)}">${n.tipo}</span>
            </div>
        `).join('');
    }
    
    popup.style.display = 'block';
}

// Fechar popup ao clicar fora dele
document.addEventListener('click', function(event) {
    const popup = document.getElementById('notificacao-popup');
    const target = event.target;
    
    // Verifica se o clique foi fora do popup e não no link de notificações
    if (popup && popup.style.display === 'block') {
        if (!popup.contains(target) && !target.closest('.nav-link[href="/doador/notificacao"]')) {
            popup.style.display = 'none';
        }
    }
});
</script>
